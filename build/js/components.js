!function(t,e){"use strict";e.initializeTouchEvents(!0),t.kc=new Keychain;var n="1Password.agilekeychain/data/default/",i=e.createClass({displayName:"OneApp",getInitialState:function(){return this.dropboxLoginScreen=e.DOM.div({className:"main-container dropbox-screen"},e.DOM.form({id:"dropbox-form",className:"form-wrapper cf"},e.DOM.button({onClick:this.authenticateDropbox(),tabIndex:"-1"},"Login to dropbox"))),{contents:[],loggedIn:!1,loginField:"",categories:[],category:""}},_setup:function(t,e,n,i){if(t)return alert("Error retrieving 1password files from Dropbox");"string"==typeof e&&(e=JSON.parse(e)),"string"==typeof n&&(n=JSON.parse(n)),i!==!0&&queue(2).defer(asyncStorage.setItem,"1p.encryptionKeys",e).defer(asyncStorage.setItem,"1p.contents",n).await(function(t){t&&alert("There was an error when saving data in database: "+t)}),kc.setEncryptionKeys(e),this.state.contents=kc.setContents(n);var s=Object.keys(this.state.contents);this.setState({category:s[0],categories:s.map(function(t){return{name:t,count:this.state.contents[t].length}},this)})},_getContents:function(){var t=cloud.dropbox.auth.readFile.bind(cloud.dropbox.auth);queue(2).defer(asyncStorage.getItem,"1p.encryptionKeys").defer(asyncStorage.getItem,"1p.contents").await(function(e,i,s){return!e&&i&&s?this._setup.bind(this)(e,i,s,!0):queue(2).defer(t,n+"encryptionKeys.js").defer(t,n+"contents.js").await(this._setup.bind(this))}.bind(this))},authenticateDropbox:function(){var t=cloud.dropbox.auth;return t.isAuthenticated()?this._getContents():t.authenticate(function(t,e){return t||!e?console.error("Error authenticating with Dropbox"):(localStorage.setItem("dropbox_auth",JSON.stringify(e.credentials())),this._getContents())}.bind(this))},switchToType:function(t){this.setState({category:t,sectionTitle:t})},switchToItem:function(t){function e(t){var e;try{"string"==typeof t&&(t=JSON.parse(t)),e=kc.decryptItem(t)}catch(n){console.error("Error: "+n)}if("OK"!=e)return void alert("An error occurred while processing item '"+t.uuid+"'.\n\n"+e);var s=t.decrypted_secure_contents,o=s.fields||Object.keys(s).map(function(t){return{designation:t,value:s[t]}}),a=JSON.parse(JSON.stringify(t));a.fields=o,i.setState({sectionTitle:t.title,selectedItem:a,screen:"detail"})}var i=this,s="1pItem-"+t.uuid;asyncStorage.getItem(s,function(i,o){o?e(o):cloud.dropbox.auth.readFile(n+t.uuid+".1password",function(t,n){if(t)return console.error(t);n=JSON.parse(n);var i=kc.getItem(n);asyncStorage.setItem(s,i,function(){}),e(i)})})},render:function(){var t,n=this.state.loginField;if(this.state.loggedIn===!0){var i=e.addons.classSet,s=i({container:!0,"item-view":"detail"===this.state.screen});t=e.DOM.div({className:"main-container"},MenuBar({onMenuClick:this.switchToType,items:this.state.categories}),e.DOM.div({className:"main-content"},Header({title:this.state.sectionTitle}),e.DOM.div({className:s},e.DOM.div({className:"content-list"},List({onItemClick:this.switchToItem,items:this.state.contents[this.state.category]})),e.DOM.div({className:"item-page"},Item({item:this.state.selectedItem})))))}else{var o=!1;t=o?e.DOM.div({className:"main-container login-screen"},e.DOM.form({id:"login-form",className:"form-wrapper cf"},e.DOM.input({id:"login_field",type:"password",autofocus:!0,placeholder:"Enter your Master Password",onChange:this.handleLoginChange,value:n}),e.DOM.button({id:"submit_login",onClick:this.verifyPassword,tabIndex:"-1"},"LOGIN"))):this.dropboxLoginScreen}return e.DOM.section({id:"main"},t)},handleLoginChange:function(t){this.setState({loginField:t.target.value})},verifyPassword:function(){var t=this,e=kc.verifyPassword(this.state.loginField);return e===!0&&(this.logoutCountDown=setTimeout(function(){kc.lock(),t.setState({loggedIn:!1,selectedItem:{}})},6e4),this.setState({loggedIn:!0})),e},getList:function(){this.setState({items:this.state.contents[type]})}});e.renderComponent(i(null),document.getElementById("app"))}(window,React);

!function(t){"use strict";t.Header=React.createClass({slide:function(){var a=t.document.body.classList;a.contains("left-nav")?a.remove("left-nav"):a.add("left-nav")},shouldComponentUpdate:function(t){return t.title!==this.props.title},render:function(){return React.DOM.div({className:"topcoat-navigation-bar"},React.DOM.div({className:"topcoat-navigation-bar__item left quarter"},React.DOM.a({id:"slide-menu-button",onClick:this.slide,className:"topcoat-icon-button--quiet slide-menu-button"},React.DOM.span({className:"topcoat-icon topcoat-icon--menu-stack"}))),React.DOM.div({className:"topcoat-navigation-bar__item center half"},React.DOM.h1({className:"topcoat-navigation-bar__title"},this.props.title)))}})}(window);
!function(t,i){"use strict";t.List=i.createClass({handleClick:function(t){this.props.onItemClick(t)},shouldComponentUpdate:function(t){return this.props.items!==t.items},render:function(){var t=this,n=function(n){return i.DOM.li({onClick:t.handleClick.bind(t,n)},n.title)};return i.DOM.ul(null,this.props.items.map(n))}}),t.Item=i.createClass({getInitialState:function(){return{fields:[]}},render:function(){var t=[];return this.props.item&&this.props.item.fields&&(t=this.props.item.fields.map(function(t){return i.DOM.li(null,t.name,": ",t.value)})),i.DOM.div(null,i.DOM.ul(null,t))}})}(window,React);
!function(t){"use strict";t.MenuItem=React.createClass({render:function(){return React.DOM.li({className:"topcoat-list__item side-nav__list__item"},React.DOM.a({href:"#",className:"side-nav__button",onClick:this.props.onMenuItemClick},this.props.title))}}),t.MenuBar=React.createClass({handleClick:function(t){this.props.onMenuClick(t)},shouldComponentUpdate:function(t){return this.props.items!==t.items},render:function(){var t=function(t){return MenuItem({onMenuItemClick:this.handleClick.bind(this,t.name),title:t.name})};return React.DOM.div({className:"side-nav"},React.DOM.div({className:"topcoat-list__container side-nav__list__container"},React.DOM.ul({className:"topcoat-list side-nav__list"},this.props.items.map(t.bind(this)))))}})}(window);